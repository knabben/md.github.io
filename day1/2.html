<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Variables lifecycle - Rust 101/102</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../init.html">ðŸ¦€</a></li><li class="chapter-item expanded "><a href="../day_1.html"><strong aria-hidden="true">1.</strong> Day 1</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../day1/1.html"><strong aria-hidden="true">1.1.</strong> Beginning it</a></li><li class="chapter-item expanded "><a href="../day1/2.html" class="active"><strong aria-hidden="true">1.2.</strong> Variables lifecycle</a></li></ol></li><li class="chapter-item expanded "><a href="../day_2.html"><strong aria-hidden="true">2.</strong> Day 2</a></li><li class="chapter-item expanded "><a href="../day_3.html"><strong aria-hidden="true">3.</strong> Day 3</a></li><li class="chapter-item expanded "><a href="../day_4.html"><strong aria-hidden="true">4.</strong> Day 4</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust 101/102</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h3 id="variables"><a class="header" href="#variables">Variables</a></h3>
<p>By default, variables are immutable, need to use <code>mut</code>. Static typing 
allow type inference, do not pass the type <code>:&lt;type&gt;</code>, and let rust infer it.</p>
<p><code>const</code> use the compile-time constants.</p>
<h4 id="shadowing"><a class="header" href="#shadowing">Shadowing</a></h4>
<p>Declare a variable with the same name as a previous variable.
The first variable is shadowed by the second on this case.</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let x = 5;
    let x = x + 1;

    {
        let x = 100;
        println!(&quot;inner scope: {x}&quot;);
        let x = true;
        println!(&quot;shadowed in inner scope: {x}&quot;);
    }
    
    println!(&quot;outer scope {x}&quot;);
}</code></pre></pre>
<h3 id="memory-management"><a class="header" href="#memory-management">Memory management</a></h3>
<p>Rust offers full control AND safety via compile time enforcement of correct memory management.
Explicit Ownership concept.</p>
<p><em>Refer to mem management section from the tutorial.</em></p>
<h2 id="ownership"><a class="header" href="#ownership">Ownership</a></h2>
<p>Binding have a scope where they are valid.
A set of rules that govern how a Rust program manages memory.
All programs have to manage the way they use memory while running.
Memory is managed through a system of ownership with a set of rules that the compiler checks.</p>
<ul>
<li>Each value has an <em>owner</em></li>
<li>There can only be one owner at a time.</li>
<li>When the owner goes out of scope, the value is dropped.</li>
</ul>
<h3 id="move"><a class="header" href="#move">Move</a></h3>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let s1 = String::from(&quot;hello&quot;);
    let s2: String = s1;
}</code></pre></pre>
<p>Data is moved from one s1 and s1 is not accessible anymore - 
This is a problem: when s2 and s1 go out of scope, they will both try to free the same memory. This is known as a double free error and is one of the memory safety bugs we mentioned previously. Freeing memory twice can lead to memory corruption, which can potentially lead to security vulnerabilities.
Rust doesnâ€™t need to free anything when s1 goes out of scope. when accessing it raises an error:</p>
<p><code>value is borrowed here after move.</code></p>
<p>Transfer ownership happens on function parameters as well.
Another way to interect is via <code>s1.close()</code>.</p>
<p>Struct must use <code>#[derive(Copy, Clone, Debug)]</code> annotation.</p>
<p>For functions is not allowed to use s after the function ownership taken</p>
<pre><pre class="playground"><code class="language-rust">fn takes_ownership(s :String) {
    println!(&quot;on function: {}&quot;, s)
}

fn main() {
    let s = String::from(&quot;hello&quot;);  // s comes into scope

    takes_ownership(s);             // s's value moves into the function...
    println!(&quot;outside function: {}&quot;, s)
}</code></pre></pre>
<h3 id="borrowing-and-lifetimes"><a class="header" href="#borrowing-and-lifetimes">Borrowing and lifetimes</a></h3>
<p>Passing references (<code>&amp;</code>) makes the data still being owner by some other variable.
<code>function(&amp;s1)</code>, allows to refer the value of s1 but do not own it. 
The caller retains ownership of the inputs.</p>
<pre><pre class="playground"><code class="language-rust">
fn main() {
    let p1 = String::from(&quot;hello&quot;);
    let f1;
    
    {
        let p2 :String = String::from(&quot;hello 2&quot;);
        f1 = function(&amp;p1.as_str(), &amp;p2.as_str());
    }
    
    println!(&quot;{f1} {p1}&quot;);
}

// returns with p2 lifetime if p2 has 'a.
// forcing the lifetime for the p1 variable allows the
// return.
fn function&lt;'a&gt;(p1 :&amp;'a str, p2 :&amp;str) -&gt; &amp;'a str{ ;; 
    println!(&quot;function {p1} {p2}&quot;);
    return p1
}</code></pre></pre>
<p>These borrowed values has a <code>lifetime</code> -  ensure that references are valid as long as we need them to be.
<code>&amp;'a String</code> means â€œa borrowed String which is valid for at least the lifetime a`</p>
<p>Reference:</p>
<p>https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html?highlight=lifetime#lifetime-elision</p>
<h3 id="exercises"><a class="header" href="#exercises">Exercises</a></h3>
<ul>
<li>Designing a library</li>
</ul>
<pre><pre class="playground"><code class="language-rust">impl Library {
    fn new(books :Vec&lt;Book&gt;) -&gt; Library {
        Library{ books }
    }

    fn len(&amp;self) -&gt; usize {
        self.books.len()
    }

    fn is_empty(&amp;self) -&gt; bool {
        self.books.is_empty()
    }

    fn add_book(&amp;mut self, book: Book) {
        self.books.push(book)
    }

    fn print_books(&amp;self) {
        for b in self.books.iter() {
            println!(&quot;{}&quot;, b)
        }
    }

    fn oldest_book(&amp;mut self) -&gt; Option&lt;&amp;Book&gt; {
        self.books.sort_by(|a, b| a.year.cmp(&amp;b.year));
        self.books.first()
    }
}

fn main() {
    // This shows the desired behavior. Uncomment the code below and
    // implement the missing methods. You will need to update the
    // method signatures, including the &quot;self&quot; parameter!
    let books :Vec&lt;Book&gt; = vec!();
    let mut library = Library::new(books);

    println!(&quot;Our library is empty: {}&quot;, library.is_empty());

    library.add_book(Book::new(&quot;Lord of the Rings&quot;, 1954));
    library.add_book(Book::new(&quot;Alice's Adventures in Wonderland&quot;, 1865));

    library.print_books();

    match library.oldest_book() {
        Some(book) =&gt; println!(&quot;My oldest book is {book}&quot;),
        None =&gt; println!(&quot;My library is empty!&quot;),
    }

   println!(&quot;Our library has {} books&quot;, library.len());
}</code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../day1/1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../day_2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../day1/1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../day_2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
